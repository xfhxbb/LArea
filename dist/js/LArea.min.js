window.LArea=function(){var e=function(){this.gearArea=null,this.data={},this.index=0,this.value=[0,0,0]};return e.prototype={init:function(e){switch(this.params=e,this.trigger=document.querySelector(e.trigger),e.valueTo&&(this.valueTo=document.querySelector(e.valueTo)),this.keys=e.keys,this.type=e.type||1,this.type){case 1:case 2:break;default:throw new Error("错误提示: 没有这种数据源类型")}return this.displayType=e.displayType||1,this.bindEvent(),this.successCallBack=e.onSuccess||function(){},this.closeCallBack=e.onClose||function(){},this},getData:function(e){var t=this;if("object"==typeof t.params.data)t.data=t.params.data,e();else{var a=new XMLHttpRequest;a.open("get",t.params.data),a.onload=function(){if(a.status>=200&&a.status<300||0===a.status){var r=JSON.parse(a.responseText);t.data=r.data,e&&e()}},a.send()}},bindEvent:function(){function e(){o.gearArea=document.createElement("div"),o.gearArea.className="gearArea",o.gearArea.innerHTML=2===c?'<div class="area_ctrl slideInUp"><div class="area_btn_box"><div class="area_btn larea_cancel">取消</div><div class="area_btn larea_finish">确定</div></div><div class="area_roll_mask"><div class="area_roll"><div><div class="gear area_province" data-areatype="area_province"></div><div class="area_grid"></div></div><div><div class="gear area_city" data-areatype="area_city"></div><div class="area_grid"></div></div></div></div></div>':'<div class="area_ctrl slideInUp"><div class="area_btn_box"><div class="area_btn larea_cancel">取消</div><div class="area_btn larea_finish">确定</div></div><div class="area_roll_mask"><div class="area_roll"><div><div class="gear area_province" data-areatype="area_province"></div><div class="area_grid"></div></div><div><div class="gear area_city" data-areatype="area_city"></div><div class="area_grid"></div></div><div><div class="gear area_county" data-areatype="area_county"></div><div class="area_grid"></div></div></div></div></div>',document.body.appendChild(o.gearArea),t();var e=o.gearArea.querySelector(".larea_cancel");e.addEventListener("touchstart",function(e){o.close(e)});var n=o.gearArea.querySelector(".larea_finish");n.addEventListener("touchstart",function(e){o.finish(e)});var s=o.gearArea.querySelector(".area_province"),l=o.gearArea.querySelector(".area_city");if(1===c){var v=o.gearArea.querySelector(".area_county");v.addEventListener("touchstart",a),v.addEventListener("touchmove",r),v.addEventListener("touchend",i)}o.gearArea.addEventListener("click",function(e){return e.target.removeEventListener(e.type,arguments.callee),d(e,document.querySelector(".area_ctrl"))}),s.addEventListener("touchstart",a),s.addEventListener("touchmove",r),s.addEventListener("touchend",i),l.addEventListener("touchmove",r),l.addEventListener("touchstart",a),l.addEventListener("touchend",i)}function t(){switch(o.gearArea.querySelector(".area_province").setAttribute("val",o.value[0]),o.gearArea.querySelector(".area_city").setAttribute("val",o.value[1]),1===c&&o.gearArea.querySelector(".area_county").setAttribute("val",o.value[2]),o.type){case 1:o.setGearTooth(o.data);break;case 2:o.setGearTooth(o.data[0])}}function a(e){e.preventDefault();for(var t=e.target;;){if(t.classList.contains("gear"))break;t=t.parentElement}clearInterval(t["int_"+t.id]),t["old_"+t.id]=e.targetTouches[0].screenY,t["o_t_"+t.id]=(new Date).getTime();var a=t.getAttribute("top");t["o_d_"+t.id]=a?parseFloat(a.replace(/em/g,"")):0,t.style.webkitTransitionDuration=t.style.transitionDuration="0ms"}function r(e){e.preventDefault();for(var t=e.target;;){if(t.classList.contains("gear"))break;t=t.parentElement}t["new_"+t.id]=e.targetTouches[0].screenY,t["n_t_"+t.id]=(new Date).getTime();var a=30*(t["new_"+t.id]-t["old_"+t.id])/window.innerHeight;t["pos_"+t.id]=t["o_d_"+t.id]+a,t.style["-webkit-transform"]="translate3d(0,"+t["pos_"+t.id]+"em,0)",t.setAttribute("top",t["pos_"+t.id]+"em"),e.targetTouches[0].screenY<1&&i(e)}function i(e){e.preventDefault();for(var t=e.target;;){if(t.classList.contains("gear"))break;t=t.parentElement}var a=t["new_"+t.id],r=t["old_"+t.id];if(a&&r){var i=(a-r)/(t["n_t_"+t.id]-t["o_t_"+t.id]);t["spd_"+t.id]=Math.abs(i)<=.2?0>i?-.08:.08:Math.abs(i)<=.5?0>i?-.16:.16:i/2,t["pos_"+t.id]||(t["pos_"+t.id]=0),n(t)}}function n(e){function t(){e.style.webkitTransitionDuration=e.style.transitionDuration="200ms",r=!0}var a=0,r=!1;clearInterval(e["int_"+e.id]),e["int_"+e.id]=setInterval(function(){var i=e["pos_"+e.id],n=e["spd_"+e.id]*Math.exp(-.03*a);if(i+=n,Math.abs(n)>.1);else{var d=2*Math.round(i/2);i=d,t()}i>0&&(i=0,t());var o=2*-(e.dataset.len-1);if(o>i&&(i=o,t()),r){var c=Math.abs(i)/2;s(e,c),clearInterval(e["int_"+e.id])}e["pos_"+e.id]=i,e.style["-webkit-transform"]="translate3d(0,"+i+"em,0)",e.setAttribute("top",i+"em"),a++},30)}function s(e,t){switch(t=Math.round(t),e.setAttribute("val",t),o.type){case 1:o.setGearTooth(o.data);break;case 2:switch(e.dataset.areatype){case"area_province":o.setGearTooth(o.data[0]);break;case"area_city":var a=e.childNodes[t].getAttribute("ref"),r=[],i=o.data[2];for(var n in i)if(n==a){r=i[n];break}o.index=2,o.setGearTooth(r)}}}function d(e,t){function a(e,t){if(t===e)return!0;for(var a=t.getElementsByTagName("*"),r=0,i=a.length;i>r;r++)if(a[r]===e)return!0;return!1}e=e?e:window.event,target=e.target||e.scrElement,a(target,t)||o.close(e)}var o=this,c=o.displayType;o.getData(function(){o.trigger.addEventListener("click",e)})},setGearTooth:function(e){var t=this,a=e||[],r=a.length;if(t.gearArea){var i=t.gearArea.querySelectorAll(".gear"),n=i[t.index],s=n.getAttribute("val"),d=r-1;if(s>d&&(s=d),n.setAttribute("data-len",r),r>0){var o,c=a[s][this.keys.id];switch(t.type){case 1:o=a[s].child;break;case 2:var l=t.data[t.index+1];for(var v in l)if(v==c){o=l[v];break}}var u="";for(v=0;r>v;v++)u+="<div class='tooth'  ref='"+a[v][this.keys.id]+"'>"+a[v][this.keys.name]+"</div>";if(n.innerHTML=u,n.style["-webkit-transform"]="translate3d(0,"+2*-s+"em,0)",n.setAttribute("top",2*-s+"em"),n.setAttribute("val",s),t.index++,t.index>2||2===t.displayType&&t.index>1)return void(t.index=0);t.setGearTooth(o)}else n.innerHTML="<div class='tooth'></div>",n.setAttribute("val",0),1==t.index&&(i[2].innerHTML="<div class='tooth'></div>",i[2].setAttribute("val",0)),t.index=0}},finish:function(e){function t(e){for(var t=0,a=e.length;a>t;t++){var r=e[t];(""===r||void 0===r||null===r)&&(e.splice(t,1),a=e.length)}return e.length>0?e:[]}var a,r,i,n,s=this,d=s.gearArea.querySelector(".area_province"),o=s.gearArea.querySelector(".area_city");1===s.displayType&&(a=s.gearArea.querySelector(".area_county"),r=parseInt(a.getAttribute("val")),i=a.childNodes[r].textContent,n=a.childNodes[r].getAttribute("ref"));var c=parseInt(d.getAttribute("val")),l=d.childNodes[c].textContent,v=(d.childNodes[c].getAttribute("ref"),parseInt(o.getAttribute("val"))),u=o.childNodes[v].textContent,h=(o.childNodes[v].getAttribute("ref"),t([l,u,i])),g=t([c,v,r]);s.trigger.value=h.join(","),s.value=g,this.valueTo&&(this.valueTo.value=g.join(",")),s.successCallBack(g,h),s.close(e)},close:function(e){e.preventDefault();var t=this,a=new CustomEvent("input");t.trigger.dispatchEvent(a),document.body.removeChild(t.gearArea),t.gearArea=null,t.closeCallBack()}},e}();